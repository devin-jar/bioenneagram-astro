---
// src/pages/es/index.astro
import Layout from '~/layouts/PageLayout.astro'; // PageLayout ya maneja la carga de 't'

// Importar componentes
import Hero from '~/components/widgets/Hero.astro';
import Note from '~/components/widgets/Note.astro';
import Features from '~/components/widgets/Features.astro';
import Steps2 from '~/components/widgets/Steps2.astro';
import Content from '~/components/widgets/Content.astro';
import Pricing from '~/components/widgets/Pricing.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import Testimonials from '~/components/widgets/Testimonials.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
// import BlogLatestPosts from '~/components/widgets/BlogLatestPosts.astro';

// Necesitamos 't' para los metadatos y el contenido de esta página
import { getTranslator, defaultLang, supportedLangs } from '~/i18n';
import esTranslations from '~/i18n/locales/en/translation.json'; // Específico para esta página 'es'

const currentLocale = 'en'; // Ya que estamos en pages/es/index.astro
const t = getTranslator(esTranslations, currentLocale);

// Los metadatos ahora usan 't'
const metadata = {
  title: t('homepage.meta.title'),
  description: t('homepage.meta.description'), // Añadí una descripción al JSON
  robots: {
    index: true,
    follow: true,
  }
};

// El Header se maneja dentro de PageLayout, no necesita pasarse aquí explícitamente
// a menos que quieras sobrescribir lo que PageLayout ya hace.
// Si PageLayout ya incluye el Header, puedes quitar el <Fragment slot="header"> de aquí.
// Por ahora, lo dejo, asumiendo que puedes tener una razón específica.
// import { getHeaderData } from '~/navigation'; // No es necesario si PageLayout lo maneja
// const headerDataForLang = getHeaderData(t, currentLocale);
---

<Layout metadata={metadata}>
  {/* Si PageLayout ya renderiza el Header, este Fragment es redundante.
      Si quieres un Header específico aquí, asegúrate que PageLayout
      no renderice uno por defecto o te permita sobrescribirlo.
  <Fragment slot="header">
    <Header {...headerDataForLang} isSticky />
  </Fragment>
  */}

  <!-- Hero Widget ******************* -->
  <Hero
    tagline={t('homepage.hero.tagline')}
    actions={[
      {
        variant: 'primary',
        target: '_blank',
        text: t('homepage.hero.action'),
        href: 'https://booking.bioenneagram.com/book',
      },
    ]}
    image={{
      src: 'https://images.unsplash.com/photo-1502325966718-85a90488dc29?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
      alt: 'Bioenneagram Hero Image', // Considera traducir 'alt' también si es descriptivo
    }}
  >
    <Fragment slot="title" set:html={t('homepage.hero.title', {'0': '<span class="text-accent dark:text-white highlight">ENEAGRAMA - BIODESCODIFICACIÓN</span>'})} />
    <Fragment slot="subtitle" set:html={t('homepage.hero.subtitle', {'1': '<span class="font-semibold">Bioenneagram</span>'})} />
  </Hero>

  <!-- Note Widget *************** -->
  <Note />

  <!-- Features Widget *************** -->
  <Features
    id="features"
    title={t('homepage.features.title')}
    subtitle={t('homepage.features.subtitle')}
    columns={2}
    items={t('homepage.features.items').map(item => ({
      ...item, // Mantiene 'icon' si está definido directamente en el item del widget
      icon: item.icon || 'tabler:star', // Proporciona un ícono por defecto si no está en JSON (o muévelo al JSON)
    }))}
  />

  <!-- Content Widget **************** -->
  <Content
    title={t('homepage.contentSection1.title')}
    subtitle={t('homepage.contentSection1.subtitle')}
    isReversed
    items={t('homepage.contentSection1.items')}
    image={{
      src: 'https://images.unsplash.com/photo-1552664730-d307ca884978?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
      alt: 'Empresa Imagen', // Traducir alt
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2" set:html={t('homepage.contentSection1.blockTitle', {'0': '<span class="text-2xl">Impulsando la Productividad y el Bienestar Laboral</span>'})} />
    </Fragment>
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </Content>

  <!-- Content Widget **************** -->
  <Content
    isAfterContent={true}
    items={t('homepage.contentSection2.items')}
    image={{
      src: 'https://images.unsplash.com/photo-1494774157365-9e04c6720e47?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
      alt: 'Relacion Amorosa Imagen', // Traducir alt
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2" set:html={t('homepage.contentSection2.blockTitle', {'0': '<span class="text-2xl">Reconstruyendo la Conexión en Parejas</span>'})} />
    </Fragment>
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </Content>

  <!-- Content Widget **************** -->
  <Content
    isReversed
    isAfterContent={true}
    items={t('homepage.contentSection3.items')}
    image={{
      src: 'https://images.unsplash.com/photo-1493836512294-502baa1986e2?q=80&w=1790&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
      alt: 'Terapia Individual Imagen', // Traducir alt
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2" set:html={t('homepage.contentSection3.blockTitle', {'0': '<span class="text-2xl">Desbloqueando el Potencial Personal</span>'})} />
    </Fragment>
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </Content>

  <!-- Pricing Widget ******************* -->
  <Pricing
    title={t('homepage.pricing.title')}
    prices={t('homepage.pricing.items').map(item => ({
      title: item.title,
      subtitle: item.subtitle,
      price: item.price,
      period: item.period,
      callToAction: { // Los hrefs se mantienen, solo el texto del botón se traduce
        target: '_blank',
        text: item.callToAction, // Texto del botón desde JSON
        href: item.title === t('homepage.pricing.items.0.title') ? 'https://www.youtube.com/@bioenneagram' : // Lógica para hrefs basada en el título traducido
              item.title === t('homepage.pricing.items.1.title') ? 'https://api.whatsapp.com/send/?phone=573004481819&text=Hola%2C+me+gustar%C3%ADa+agendar+un+espacio+contigo&type=phone_number&app_absent=0' :
              item.title === t('homepage.pricing.items.2.title') ? 'https://api.whatsapp.com/send/?phone=573004481819&text=Hola%2C+me+gustar%C3%ADa+agendar+un+espacio+contigo&type=phone_number&app_absent=0' :
              'https://api.whatsapp.com/send/?phone=573004481819&text=Hola%2C+me+gustar%C3%ADa+agendar+un+espacio+contigo&type=phone_number&app_absent=0',
      },
      hasRibbon: item.ribbonTitle ? true : false, // Determinar hasRibbon basado en si ribbonTitle existe
      ribbonTitle: item.ribbonTitle || '', // ribbonTitle desde JSON
    }))}
  />

  <!-- Testimonials Widget *********** -->
  <Testimonials
    title={t('homepage.testimonials.title')}
    subtitle={t('homepage.testimonials.subtitle')}
    testimonials={t('homepage.testimonials.items').map((item, index) => ({
      testimonial: item.testimonial,
      name: item.name,
      job: item.job,
      // Las imágenes se mantienen, los 'alt' podrían traducirse si se añaden al JSON
      image: index === 0 ? { src: 'https://i.postimg.cc/V6fSq5R2/img-photo-profile-aleja.jpg', alt: `${item.name} Image` } :
             index === 1 ? { src: 'https://i.postimg.cc/zfSbHTnn/img-photo-profile-juanda.jpg', alt: `${item.name} Image` } :
             { src: 'https://i.postimg.cc/XJsbTvbM/img-photo-profile-sara.jpg', alt: `${item.name} Image` },
    }))}
  />

  <!-- CallToAction Widget *********** -->
  <CallToAction
    title={t('homepage.callToAction.title')}
    subtitle={t('homepage.callToAction.subtitle')}
    actions={[
      {
        variant: 'primary',
        text: t('homepage.callToAction.action'),
        href: 'https://api.whatsapp.com/send/?phone=573004481819&text=Hola%2C+me+gustar%C3%ADa+agendar+un+espacio+contigo&type=phone_number&app_absent=0',
      },
    ]}
  />

  <!-- FAQs Widget ******************* -->
  <FAQs
    title={t('homepage.faqs.title')}
    items={t('homepage.faqs.items').map(item => ({
      ...item, // Mantiene 'icon' si está definido directamente en el item del widget
      icon: item.icon || 'tabler:chevrons-right', // Ícono por defecto o del JSON
    }))}
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </FAQs>

  <!-- Steps2 Widget ****************** -->
  <Steps2
    title={t('homepage.steps2.title')}
    subtitle={t('homepage.steps2.subtitle')}
    callToAction={{
      text: t('homepage.steps2.callToAction'),
      target: '_blank',
      href: 'https://forms.gle/H1dRuGBHvAGP9hy3A',
    }}
    items={t('homepage.steps2.items').map((item, index) => ({
      title: item.title,
      description: item.description,
      // Hrefs se mantienen, los íconos se pueden mover al JSON si se desea
      href: index === 0 ? 'mailto:bioenneagramcoach@gmail.com?Subject=Interesado%20en%20los%20productos' :
            index === 1 ? 'tel:+573004481819' :
            'https://www.instagram.com/bioenneagramcoach/',
      icon: index === 0 ? 'tabler:mail' : index === 1 ? 'tabler:headset' : 'tabler:brand-instagram',
    }))}
  />

 <!-- BlogLatestPost Widget **************** -->
  <!-- 
  <BlogLatestPosts
    id="blog"
    title={t('homepage.blogLatestPosts.title')}
    information={t('homepage.blogLatestPosts.information')}
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </BlogLatestPosts>
  -->
</Layout>